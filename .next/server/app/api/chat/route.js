"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4291:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>T,requestAsyncStorage:()=>j,routeModule:()=>E,serverHooks:()=>S,staticGenerationAsyncStorage:()=>v});var a={};r.r(a),r.d(a,{POST:()=>b});var o=r(3278),n=r(5002),s=r(4877),l=r(1309),i={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},c={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},p={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},d={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},u={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},m={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},f={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},y={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>{null!=e&&"object"==typeof e&&"id"in e&&"string"==typeof e.id&&"type"in e&&"string"==typeof e.type&&"function"in e&&null!=e.function&&"object"==typeof e.function&&"arguments"in e.function&&"string"==typeof e.function.name&&e.function.arguments}))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},g={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},h={[i.code]:i,[c.code]:c,[p.code]:p,[d.code]:d,[u.code]:u,[m.code]:m,[f.code]:f,[y.code]:y,[g.code]:g},_=(i.name,i.code,c.name,c.code,p.name,p.code,d.name,d.code,u.name,u.code,m.name,m.code,f.name,f.code,y.name,y.code,g.name,g.code,[i,c,p,d,u,m,f,y,g].map(e=>e.code)),x=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!_.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let a=JSON.parse(e.slice(t+1));return h[r].parse(a)};((e,t=21)=>(r=t)=>{let a="",o=r;for(;o--;)a+=e[Math.random()*e.length|0];return a})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);new TextDecoder("utf-8");Symbol("internal_openai_fn_messages");var w=class extends Response{constructor(e,t,r){let a=e;r&&(a=e.pipeThrough(r.stream)),super(a,{...t,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":r?"true":"false",...null==t?void 0:t.headers}})}};async function b(e){try{let{messages:t}=await e.json();console.log("\uD83D\uDE80 Ollama Request:",{model:"Garry:latest",messages:t.slice(-1),options:{num_predict:300}});let r=await fetch("http://10.0.0.1:11434/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"Garry:latest",messages:t,stream:!0,options:{num_predict:300,stop:["\n\n","Human:","Assistant:","USER:","ASSISTANT:"],temperature:.7,top_k:50,top_p:.7,repeat_penalty:1.1}})});if(!r.ok)throw Error(`Ollama error: ${r.status}`);let a=0,o="",n="",s=new TransformStream({async transform(e,t){try{for(let r of new TextDecoder().decode(e).split("\n").filter(Boolean)){let e=JSON.parse(r);if(console.log("\uD83D\uDCE5 Ollama Raw Response:",e),e.message?.content&&(o+=e.message.content,/[\s.!?]$/.test(o))){let e=o.replace(/USER:|ASSISTANT:|Human:|Assistant:/g,"").replace(/([,.!?])/g,"$1 ").replace(/\s+/g," ").trim();if(n+=e,o="",/[.!?]$/.test(e)){if(a+n.length<=300)a+=n.length,t.enqueue(new TextEncoder().encode(n)),n="";else{if(300-a>0){let e=n.match(/[^.!?]+[.!?]/g)?.pop()||n;t.enqueue(new TextEncoder().encode(e))}t.terminate();break}}}e.done&&(n&&a+n.length<=300&&t.enqueue(new TextEncoder().encode(n)),t.terminate())}}catch(e){console.error("Stream transform error:",e)}}});return new w(r.body.pipeThrough(s))}catch(e){return console.error("Chat API Error:",e),l.NextResponse.json({error:"Chat service error"},{status:500})}}let E=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"C:\\Users\\PC\\Desktop\\backup\\SEC Chat\\app\\api\\chat\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:j,staticGenerationAsyncStorage:v,serverHooks:S}=E,A="/api/chat/route";function T(){return(0,s.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:v})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[787,833],()=>r(4291));module.exports=a})();